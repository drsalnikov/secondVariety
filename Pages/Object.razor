@page "/Objects/{Kod:int}"

@using Microsoft.EntityFrameworkCore
@using SecondVariety.Models;
@using SecondVariety.Data;

@inject db1Context db1Context

<RadzenTemplateForm Data="@myObj" Submit="@((MyObject args) => { Submit(args); })">
  <div class="row gap-3">
    <div class="col-lg-12">
      <RadzenFieldset Text="Информация об объекте">
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Наименование:" />
            <RadzenTextBox @bind-Value=@myObj.Name />
          </div>
          <div class="col align-items-center">
            <RadzenLabel Text="Код:" />
            <RadzenNumeric TValue="int" @bind-Value=@myObj.Kod />
          </div>
        </div>
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Дата последнего ТО:" />
            <RadzenDatePicker @bind-Value=@myObj.LastTo DateFormat="d" />
          </div>
          <div class="col align-items-center">
            <RadzenLabel Text="Дата следующего ТО:" />
            <RadzenDatePicker @bind-Value=@myObj.LastTo DateFormat="d" />
          </div>
        </div>
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Межремонтный интервал (дни):" />
            <RadzenNumeric TValue="int" @bind-Value=@myObj.ToTime />
          </div>
          <div class="col align-items-center">
            <RadzenLabel Text="Межремонтный интервал (моточасы):" />
            <RadzenNumeric TValue="int" @bind-Value=@myObj.ToNar />
          </div>
        </div>
      </RadzenFieldset>
    </div>
  </div>
  <div class="row gap-3">
    <div class="col-lg-12">
      <RadzenFieldset Text="Наработка">
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Начальная дата:" />
            <RadzenDatePicker TValue="DateOnly" @bind-Value=@myObj.DateFrom />
          </div>
          <div class="col align-items-center">
            <RadzenLabel Text="Начальное значение наработки:" />
            <RadzenNumeric TValue="int" @bind-Value=@myObj.NarFrom />
          </div>
        </div>
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Планируемая наработка в год:" />
          </div>
          <div class="col align-items-center">
            <RadzenNumeric TValue="int" @bind-Value=@myObj.PlanYear />
          </div>
        </div>
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Текущая наработка:" />
            <RadzenNumeric TValue="int" @bind-Value=@myObj.TekNar />
          </div>
          <div class="col align-items-center">
            <RadzenLabel Text="Среднедневная наработка:" />
            <RadzenNumeric TValue="int" @bind-Value=@myObj.SredNar />
          </div>
        </div>
        <div class="row">
          <div class="col align-items-center">
            <RadzenLabel Text="Коэфициент изменения веса дня:" />
            <RadzenNumeric TValue="float" @bind-Value=@myObj.Koef1 />
          </div>
          <div class="col align-items-center">
            <RadzenLabel Text="Коэфициент веса средней наработки:" />
            <RadzenNumeric TValue="float" @bind-Value=@myObj.Koef2 />
          </div>
        </div>
      </RadzenFieldset>
    </div>
  </div>
</RadzenTemplateForm>

<EventConsole @ref=@console Class="mt-4" />

@code {
  [Parameter]
  public int Kod { get; set; }

  EventConsole console;

  public string name = "";
  public DateTime lastTo;
  //public DateTime lastTo;


  public MyObject myObj = new MyObject();
  public SecondVariety.Models.Object obj { get; set; }

  private bool isLoading;

  protected override async Task OnInitializedAsync()
  {
    await base.OnInitializedAsync();
    await LoadData();
  }

  async Task LoadData()
  {
    isLoading = true;
    await Task.Yield();
    obj = db1Context.Objects.Where(o => o.Kod == Kod).FirstOrDefault();
    if (obj != null)
    {
      myObj = new MyObject(obj);
    }
    isLoading = false;

  }

  void Submit(MyObject arg)
  {
      console.Log(arg);
  }

}